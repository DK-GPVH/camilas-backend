DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `agregar_categoria`(
	IN _nombre varchar(50),
    IN _descripcion varchar(250),
    IN _abreviatura char(3)
)
BEGIN
	INSERT INTO categoria(nombre,descripcion,abreviatura) VALUES (_nombre,_descripcion,_abreviatura);
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `agregar_cliente`(
	IN _nombre varchar(250),
    IN _tipo_documento varchar(50),
    IN _numero_documento varchar(50),
    IN _telefono int,
    IN _direccion varchar(250),
    IN _correo varchar(250)
)
BEGIN 
	INSERT INTO cliente(nombre,documento_identidad,numero_documento,telefono,direccion,correo) VALUES (_nombre,_tipo_documento,_numero_documento,_telefono,_direccion,_correo);
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `agregar_compra`(
	IN _usuario_id int,
    IN _proveedor_id int,
    IN _fecha datetime,
    IN _tipo_comprobante varchar(50),
    IN _serie_comprobante varchar(25),
    IN _numero_comprobante varchar(25),
    IN _precio_total varchar (25)
)
BEGIN
	INSERT INTO compra(usuario_id,proveedor_id,fecha,tipo_comprobante,serie_comprobante,numero_comprobante,precio_total)
    VALUES (_usuario_id,_proveedor_id,_fecha,_tipo_comprobante,_serie_comprobante,_numero_comprobante,_precio_total);
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `agregar_detalle_compra`(IN `_compra_id` INT, IN `_producto_id` INT, IN `_precio_compra` FLOAT, IN `_cantidad` INT)
BEGIN
		INSERT INTO `detalle-compra`(compra_id,producto_id,precio_compra,cantidad) VALUES (_compra_id,_producto_id,_precio_compra,_cantidad);
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `agregar_detalle_venta`(
	IN _venta_id int,
    IN _producto_id int,
    IN _precio_venta float,
    IN _cantidad int
)
BEGIN
	DECLARE cantidad_recuperada int;
    SELECT cantidad INTO cantidad_recuperada FROM producto WHERE id = _producto_id;
    IF(cantidad_recuperada > _cantidad) THEN
    	SIGNAL SQLSTATE '45001' SET MESSAGE_TEXT = 'La cantidad que usted desea no esta disponible';
    ELSE
		INSERT INTO `detalle-venta`(venta_id,producto_id,precio_venta,cantidad) VALUES (_venta_id,_producto_id,_precio_venta,_cantidad);
	END IF;
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `agregar_producto`(
	IN _nombre varchar(100),
    IN _categoria_id int,
    IN _precio_unitario_referencial float,
    IN _cantidad int
)
BEGIN 
	INSERT INTO producto(nombre,categoria_id,precio_unitario_referencial,cantidad)
    VALUES (_nombre,_categoria_id,_precio_unitario_referencial,_cantidad);
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `agregar_proveedor`(
	IN _nombre varchar(250),
    IN _tipo_documento varchar(50),
    IN _numero_documento varchar(50),
    IN _telefono int,
    IN _correo varchar(250),
    IN _direccion varchar(250)
)
BEGIN
	INSERT INTO proveedor(nombre,documento_identidad,numero_documento,telefono,correo,direccion)
    VALUES (_nombre,_tipo_documento,_numero_documento,_telefono,_correo,_direccion);
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `agregar_sucursal`(IN `_nombre` VARCHAR(100), IN `_direccion` VARCHAR(250), IN `_contacto` INT)
BEGIN
	IF(LENGTH(_contacto) <> 9)THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'El valor no tiene 9 digitos';
	ELSE 
    INSERT INTO sucursal(nombre,direccion,contacto) VALUE (_nombre,_direccion,_contacto);
	END IF;
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `agregar_usuario`(IN `_nombre` VARCHAR(250), IN `_tipo_documento` VARCHAR(50), IN `_numero_documento` VARCHAR(50), IN `_direccion` VARCHAR(50), IN `_telefono` INT, IN `_cargo` VARCHAR(50), IN `_correo` VARCHAR(250), IN `_contrasenia` VARCHAR(200))
BEGIN
	INSERT INTO usuario(nombre,documento_identidad,numero_documento,direccion,telefono,cargo,correo,contrase√±a) VALUES (_nombre,_tipo_documento,_numero_documento,_direccion,_telefono,_cargo,_correo,_contrasenia);
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `agregar_usuario_sucursal`(
	IN _id_usuario int,
    IN _id_sucursal int,
    IN _hora_entrada time,
    IN _hora_salida time
)
BEGIN
	INSERT INTO `usuario-sucursal`(usuario_id,sucursal_id,hora_entrada,hora_salida) VALUES (_id_usuario,_id_sucursal,_hora_entrada,_hora_salida);
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `agregar_venta`(
	IN _usuario_id int,
    IN _cliente_id int,
    IN _sucursal_id int,
    IN _tipo_comprobante varchar(50),
    IN _serie_comprobante varchar(25),
    IN _numero_comprobante varchar(25),
    IN _fecha datetime,
    IN _precio_total float,
    IN _estado tinyint,
    IN _estado_sunat tinyint ,
    IN _serie_comprobante_sunat varchar(25),
    IN _numero_comprobante_sunat varchar(25)
)
BEGIN
	INSERT INTO venta(usuario_id, cliente_id, sucursal_id, tipo_comprobante, serie_comprobante, numero_comprobante, fecha, precio_total, estado, estado_sunat, serie_comprobante_sunat, numero_comprobante_sunat) VALUES (_usuario_id, _cliente_id, _sucursal_id, _tipo_comprobante, _serie_comprobante, _numero_comprobante, _fecha, _precio_total, _estado, _estado_sunat, _serie_comprobante_sunat, _numero_comprobante_sunat);
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `filtrar_usuario_sucursal_por_sucursal`(
	IN _sucursal_id int
)
BEGIN
	SELECT u.nombre, u.documento_identidad, u.numero_documento, u.cargo, u.telefono, u.correo, us.hora_entrada, us.hora_salida, s.nombre, s.direccion, s.contacto from 
	`usuario-sucursal` as us INNER JOIN  usuario as u
	ON us.usuario_id = u.id
	INNER JOIN sucursal as s
	ON us.sucursal_id = s.id
    WHERE us.sucursal_id = _sucursal_id;
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `filtrar_usuario_sucursal_por_usuario`(
    	IN _id_usuario int
    )
BEGIN
    	SELECT u.nombre, u.documento_identidad, u.numero_documento, u.cargo, u.telefono, u.correo, us.hora_entrada, us.hora_salida, s.nombre, s.direccion, s.contacto from 
		`usuario-sucursal` as us INNER JOIN  usuario as u
		ON us.usuario_id = u.id
		INNER JOIN sucursal as s
		ON us.sucursal_id = s.id
    	WHERE us.usuario_id = _id_usuario;
    END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `listar_categorias`()
BEGIN
	SELECT * FROM categoria;
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `listar_clientes`()
BEGIN
	SELECT * FROM cliente;
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `listar_proveedores`()
BEGIN
	SELECT * from proveedor;
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `listar_sucursales`()
BEGIN
	SELECT * FROM sucursal;
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `listar_usuarios_sucursal`()
BEGIN
	SELECT u.nombre, u.documento_identidad, u.numero_documento, u.cargo, u.telefono, u.correo, us.hora_entrada, us.hora_salida, s.nombre, s.direccion, s.contacto from 
	`usuario-sucursal` as us INNER JOIN  usuario as u
	ON us.usuario_id = u.id
	INNER JOIN sucursal as s
	ON us.sucursal_id = s.id;
END$$
DELIMITER ;
